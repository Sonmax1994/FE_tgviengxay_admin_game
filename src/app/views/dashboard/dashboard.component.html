<c-breadcrumb class="font-weigth-500 mb-5">
  <c-breadcrumb-item url="#">Trang Chủ</c-breadcrumb-item>
  <c-breadcrumb-item [active]="true">Danh Sách Game</c-breadcrumb-item>
</c-breadcrumb>
<c-row>
  @for (game of listGames; track game.id) {
    <c-col sm="6">
      <c-card>
        <c-card-header>
          <h4 class="card-title mb-0 text-center">{{game.name | uppercase }}</h4>
        </c-card-header>
        <c-card-body>
          <div class="d-flex align-item-center my-2 mb-4">
            <div *ngIf="game.type == 1" class={{onRenderStatusClass(game.status)}}></div>
            <div class="status-text" [ngClass]="{'opacity-0': game.type == 2}">{{onRenderGameStt(game.status) | uppercase}}</div>
          </div>
          <div class="d-flex align-item-center btn-actions">
            <button *ngIf="game.type == 1" class="gray" [cModalToggle]="listMatchModal.id" (click)="onShowModalListMatch()">QUẢN LÍ TRẬN ĐẤU</button>
            <button *ngIf="game.type == 2" class="gray" (click)="onShowModalCurrentSessionXD()">TRẬN ĐẤU HIỆN TẠI</button>
            <button class="brown" [cModalToggle]="result.id" (click)="onShowModalResult(game.type)">TRẢ KẾT QUẢ</button>
          </div>
          <div class="d-flex align-item-center btn-actions">
            <button class="blue" [cModalToggle]="modal.id" (click)="onShowModalConfirm(1, game.type)">NGƯNG NHẬN CƯỢC</button>
            <button *ngIf="game.type == 1" class="red" [cModalToggle]="modal.id" (click)="onShowModalConfirm(2, game.type)">KẾT THÚC PHIÊN</button>
            <button *ngIf="game.type == 2" class="red" (click)="onFinishXD(2)">KẾT THÚC VÁN ĐẤU</button>
          </div>
          <div class="d-flex align-item-center btn-actions">
            <button *ngIf="game.type == 1" class="green" [cModalToggle]="newsession.id" (click)="onShowModalNewSession(game.type)">MỞ CƯỢC</button>
            <button *ngIf="game.type == 2" class="green" (click)="onCreateXD(2)">TẠO VÁN MỚI</button>
          </div>
        </c-card-body>
      </c-card>
    </c-col>
  }
</c-row>
<c-modal #modal backdrop="static" id="modal" [visible]="isModalVisibleFinishOrStop">
  <c-modal-body>
    <h5 cModalTitle class="w-100 text-center mb-4">{{title}}</h5>
    <ng-container *ngIf="selectedRoomId === 1">
      <p class="label-txt font-weigth-500">TRẬN ĐẤU:</p>
      <select class="input-el w-100 mb-3" [(ngModel)]="selectedMatchId">
        <option value="0" disabled>Chọn trận đấu</option>
        @for (match of listMatch; track match.matchId) {
          @if (match.status != 4) {
            <option value="{{match.matchId}}">{{match.matchName}}</option>
          }
        }
      </select>
    </ng-container>
  </c-modal-body>
  <c-modal-footer>
    <button [cModalToggle]="modal.id" cButton color="secondary">
      HỦY
    </button>
    <button cButton color="primary" (click)="onConfirmFinishOrStop()">XÁC NHẬN</button>
  </c-modal-footer>
</c-modal>
<c-modal backdrop="static" id="currentSession" [visible]="isModalVisibleCurrentSessionXD">
  <c-modal-header>
    <h5 cModalTitle class="w-100 text-center">THÔNG TIN CHI TIẾT</h5>
  </c-modal-header>
  <c-modal-body>
    <p class="d-flex align-items-center">
      Trạng Thái: {{currentActiveMatchXD.statusMatch}}
      <button cButton color="danger" style="color: #fff; margin-left: 10px;" (click)="onFinishXD(1)">KẾT THÚC TRẬN ĐẤU</button>
    </p>
    <div>
      Link Live Stream:
      <input name="link" type="text" placeholder="Link live stream" class="input-el" [(ngModel)]="currentActiveMatchXD.urlLiveStream">
    </div>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="isModalVisibleCurrentSessionXD = false;">
      ĐÓNG
    </button>
    <button cButton color="primary" (click)="onUpdateXD()">CẬP NHẬT</button>
  </c-modal-footer>
</c-modal>
<c-modal #result backdrop="static" id="result" [visible]="isModalVisibleResult">
  <c-modal-header>
    <h5 cModalTitle class="w-100 text-center">KẾT QUẢ</h5>
  </c-modal-header>
  <c-modal-body>
    <ng-container *ngIf="selectedRoomId === 1; else elseTemplate">
      <p class="label-txt font-weigth-500">TRẬN ĐẤU:</p>
      <select class="input-el w-100 mb-3" [(ngModel)]="selectedMatchId">
        <option value="0" disabled>Chọn trận đấu</option>
        @for (match of listMatch; track match.matchId) {
          @if (match.status != 4) {
            <option value="{{match.matchId}}">{{match.matchName}}</option>
          }
        }
      </select>
      <p class="font-weigth-500">
        CHỌN GÀ CHIẾN THẮNG:
      </p>
      <div class="d-flex justify-content-evenly">
        <c-form-check>
          <input cFormCheckInput type="radio" value="draw" name="chickenOpt" id="chickenhoa" [(ngModel)]="resultObj.winner" />
          <label cFormCheckLabel for="chickenhoa">HÒA</label>
        </c-form-check>
        <c-form-check>
          <input cFormCheckInput type="radio" value="blue" name="chickenOpt" id="chickengreen" [(ngModel)]="resultObj.winner" />
          <label cFormCheckLabel for="chickengreen">GÀ XANH</label>
        </c-form-check>
        <c-form-check>
          <input cFormCheckInput type="radio" value="red" name="chickenOpt" id="chickenred" [(ngModel)]="resultObj.winner" />
          <label cFormCheckLabel for="chickenred">GÀ ĐỎ</label>
        </c-form-check>
      </div>
    </ng-container>
    <ng-template #elseTemplate>
      <p class="font-weigth-500">
        CHỌN KẾT QUẢ CỦA VÁN ĐẤU:
      </p>
      <div>
        <c-form-check>
          <input cFormCheckInput type="radio" value="0" name="xdOpt" id="0white" [(ngModel)]="objXD.result" />
          <label cFormCheckLabel for="0white">0 Trắng + 4 Đỏ (Chẵn)</label>
        </c-form-check>
        <c-form-check>
          <input cFormCheckInput type="radio" value="1" name="xdOpt" id="1white" [(ngModel)]="objXD.result" />
          <label cFormCheckLabel for="1white">1 Trắng + 3 Đỏ (Lẻ)</label>
        </c-form-check>
        <c-form-check>
          <input cFormCheckInput type="radio" value="2" name="xdOpt" id="2white" [(ngModel)]="objXD.result" />
          <label cFormCheckLabel for="2white">2 Trắng + 2 Đỏ (Chẵn)</label>
        </c-form-check>
        <c-form-check>
          <input cFormCheckInput type="radio" value="3" name="xdOpt" id="3white" [(ngModel)]="objXD.result" />
          <label cFormCheckLabel for="3white">3 Trắng + 1 Đỏ (Lẻ)</label>
        </c-form-check>
        <c-form-check>
          <input cFormCheckInput type="radio" value="4" name="xdOpt" id="4white" [(ngModel)]="objXD.result" />
          <label cFormCheckLabel for="4white">4 Trắng + 0 Đỏ (Chẵn)</label>
        </c-form-check>
      </div>
    </ng-template>
  </c-modal-body>
  <c-modal-footer>
    <button [cModalToggle]="result.id" cButton color="secondary">
      ĐÓNG
    </button>
    <button cButton color="primary" (click)="onSetResult()">XÁC NHẬN</button>
  </c-modal-footer>
</c-modal>
<c-modal #newsession backdrop="static" id="newsession" [visible]="isModalVisibleNewSession">
  <c-modal-header>
    <h5 cModalTitle class="w-100 text-center">{{isEditMatch ? "THAY ĐỔI THÔNG TIN PHIÊN CƯỢC" : "PHIÊN CƯỢC MỚI"}}</h5>
  </c-modal-header>
  <c-modal-body>
    <div class="mb-3">
      <div class="d-block mb-1 font-weigth-500">TRẬN ĐẤU:</div>
      <input name="match" type="text" placeholder="Trận đấu" class="input-el" [(ngModel)]="newSession.matchName">
    </div>
    <div class="mb-3">
      <div class="d-block mb-1 font-weigth-500">TÊN GÀ XANH:</div>
      <input name="chicken1" type="text" placeholder="Tên gà xanh" class="input-el" [(ngModel)]="newSession.chickenBlue">
    </div>
    <div class="mb-3">
      <div class="d-block mb-1 font-weigth-500">TÊN GÀ ĐỎ:</div>
      <input name="chicken2" type="text" placeholder="Tên gà đỏ" class="input-el" [(ngModel)]="newSession.chickenRed">
    </div>
    <div>
      <div class="d-block mb-1 font-weigth-500">LINK LIVE STREAM:</div>
      <input name="link" type="text" placeholder="Link live stream" class="input-el" [(ngModel)]="newSession.urlLiveStream">
    </div>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="isModalVisibleNewSession = false;">
      HỦY
    </button>
    <button cButton color="primary" (click)="onCreateNewSession()">XÁC NHẬN</button>
  </c-modal-footer>
</c-modal>
<c-modal #listMatchModal backdrop="static" id="listMatchModal" [visible]="isModalVisibleListMatch">
  <c-modal-header>
    <h5 cModalTitle class="w-100 text-center">DANH SÁCH TRẬN ĐẤU</h5>
  </c-modal-header>
  <c-modal-body>
    <table bordered cTable>
      <thead>
        <tr>
          <th scope="col" class="text-center">ID</th>
          <th scope="col" class="text-center">TÊN TRẬN ĐẤU</th>
          <th scope="col" class="text-center">TRẠNG THÁI</th>
          <th scope="col" class="text-center">HÀNH ĐỘNG</th>
        </tr>
      </thead>
      <tbody>
        @for (match of listMatch; track match.matchId) {
          <tr>
            <td class="text-center">{{match.matchId}}</td>
            <td class="text-center">{{match.matchName}}</td>
            <td class="text-center">{{onRenderGameStt(match.status)}}</td>
            <td class="text-left">
              <span class="detail-txt" (click)="onSelectMatch(match)" title="Chi Tiết">
                <svg [cIcon]="icons.cilList" size="xl" ></svg>
              </span>
              <span *ngIf="match.status == 3" class="detail-txt" title="Mở Lại Cược"(click)="onReopenMatch(match)">
                <svg [cIcon]="icons.cilPencil" size="xl"></svg>
              </span>
              <span *ngIf="match.status != 4" class="detail-txt" title="Thay Đổi Thông Tin"(click)="onEditMatch(match)">
                <svg [cIcon]="icons.cilSettings" size="xl"></svg>
              </span>
            </td>
          </tr>
        }
      </tbody>
    </table>
    <div class="match-detail" *ngIf="selecteMatch">
      <h6 class="text-center">
        THÔNG TIN CHI TIẾT TRẬN ĐẤU
      </h6>
      <p>
        TÊN TRẬN ĐẤU: {{selecteMatch.matchName}}
      </p>
      <p>
        THỜI GIAN BẮT ĐẦU: {{selecteMatch.startTime * 1000 | date:'dd/MM/yyyy HH:mm'}}
      </p>
      <p>
        THỜI GIAN KẾT THÚC: {{selecteMatch.endTime && selecteMatch.endTime * 1000 | date:'dd/MM/yyyy HH:mm'}}
      </p>
      <P>
        KẾT QUẢ: {{selecteMatch.result.winnerName}}
        <button cButton color="warning" style="margin-left: 20px;"
        *ngIf="selecteMatch.status == 4"
        (click)="
          isUpdateResult = true; 
          updateMatch = selecteMatch; 
          resultObj.winner = selecteMatch.result.winner;
        ">
          Thay Đổi Kết Quả
        </button>
      </P>
      <div class="update-result" *ngIf="isUpdateResult">
        <p class="font-weigth-500">
          CẬP NHẬT KẾT QUẢ: CHỌN GÀ CHIẾN THẮNG
        </p>
        <div class="d-flex justify-content-evenly">
          <c-form-check>
              <input cFormCheckInput type="radio" value="draw" name="chickenOpt" id="chickenhoa" [(ngModel)]="resultObj.winner" />
            <label cFormCheckLabel for="chickenhoa">HÒA</label>
          </c-form-check>
          <c-form-check>
              <input cFormCheckInput type="radio" value="blue" name="chickenOpt" id="chickengreen" [(ngModel)]="resultObj.winner" />
            <label cFormCheckLabel for="chickengreen">GÀ XANH</label>
          </c-form-check>
          <c-form-check>
              <input cFormCheckInput type="radio" value="red" name="chickenOpt" id="chickenred" [(ngModel)]="resultObj.winner" />
            <label cFormCheckLabel for="chickenred">GÀ ĐỎ</label>
          </c-form-check>
        </div>
        <div class="btn-update-result d-flex justify-content-end mt-3">
          <button cButton color="secondary" (click)="isUpdateResult = false;">
            HỦY
          </button>
          <button cButton color="primary" (click)="onChangeResult()">XÁC NHẬN</button>
        </div>
      </div>
      <p>THÔNG TIN GÀ:</p>
      <table bordered cTable>
        <thead>
          <tr>
            <th scope="col" class="text-center">GÀ XANH</th>
            <th scope="col" class="text-center">GÀ ĐỎ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center">{{selecteMatch.chickenBlue}}</td>
            <td class="text-center">{{selecteMatch.chickenRed}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </c-modal-body>
  <c-modal-footer>
    <button [cModalToggle]="listMatchModal.id" cButton color="secondary">
      ĐÓNG
    </button>
  </c-modal-footer>
</c-modal>
<c-modal backdrop="static" [visible]="isModalReopenMatch">
  <c-modal-body>
    <h5 cModalTitle class="w-100 text-center mb-4">
      BẠN ĐANG MỞ LẠI CƯỢC CHO TRẬN ĐẤU: {{reopenMatch?.matchName}}
    </h5>
  </c-modal-body>
  <c-modal-footer>
    <button (click)="isModalReopenMatch = false" cButton color="secondary">
      HỦY
    </button>
    <button cButton color="primary" (click)="onConfirmReopen()">XÁC NHẬN</button>
  </c-modal-footer>
</c-modal>
<c-modal #newsessionxd backdrop="static" id="newsessionXD" [visible]="isCreateXD">
  <c-modal-header>
    <h5 cModalTitle class="w-100 text-center">
      {{typeXD == 1 ? "TẠO TRẬN MỚI" : "BẠN CÓ CHẮC CHẮN MUỐN TẠO VÁN MỚI?"}}
    </h5>
  </c-modal-header>
  <c-modal-body *ngIf="typeXD===1">
    <div>
      <div class="d-block mb-1 font-weigth-500">LINK LIVE STREAM:</div>
      <input name="link" type="text" placeholder="Link live stream" class="input-el" [(ngModel)]="newSessionXD.urlLiveStream">
    </div>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="isCreateXD = false;">
      HỦY
    </button>
    <button cButton color="primary" (click)="onCreateNewSessionXD()">XÁC NHẬN</button>
  </c-modal-footer>
</c-modal>
<c-modal backdrop="static" id="modalXD" [visible]="isFinishXD">
  <c-modal-body>
    <h5 cModalTitle class="w-100 text-center mb-4">
      {{typeXD == 1 ? 'BẠN CÓ CHẮC CHẮN MUỐN KẾT THÚC TRẬN ĐẤU NÀY?' : 'BẠN CÓ CHẮC CHẮN MUỐN KẾT THÚC VÁN ĐẤU NÀY?'}}
    </h5>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="isFinishXD = false;">
      HỦY
    </button>
    <button cButton color="primary" (click)="onConfirmFinishXD()">XÁC NHẬN</button>
  </c-modal-footer>
</c-modal>